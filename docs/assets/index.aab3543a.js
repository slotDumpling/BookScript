import{d as t,r as e,o as i,c as s,J as n,_ as a,a as o,b as l,e as r,f as c,F as h,g as d,w as u,u as f,E as g,i as p,p as m,h as y,j as b,k as x,l as v,m as w,n as U,q as L,K as T,v as F,s as k,t as E,x as M,y as S,z as P,A as I,B}from"./vendor.ce6a9cf6.js";var R=t({setup:t=>(t,n)=>{const a=e("router-view");return i(),s(a)}});function H(t,e){const i=t.split("/").slice(0,-1),s=e.split("/");for(var n=0;n<s.length;n++)"."!=s[n]&&(".."==s[n]?i.pop():i.push(s[n]));return i.join("/")}function C(t,e){const i=t.split("/").slice(0,-1),s=e.split("/");for(;i[0]===s[0];)i.shift(),s.shift();let n=new Array(i.length).fill("..");return n=n.concat(s),n.join("/")}function D(t){let e=t.split("/").slice(0,-1).join("/");return""!==e&&(e+="/"),e}function N(t){const e=t.map(D);return a.head(a(e).countBy().entries().maxBy(a.last))}class z{constructor(t){this.zip=new n,this.loaded=!1,this.dp=new DOMParser,this.name="",this.fileList=[],this.textFileList=[],this.textPath="",this.styleFileList=[],this.stylePath="",this.imageFileList=[],this.imageBlobs=[],this.imagePath="",this.textDocs={},this.opfFilePath="",this.opfDoc=new Document,this.ncxFilePath="",this.ncxDoc=new Document,void 0!==t&&(this.file=t,this.name=t.name)}async load(){if(!this.loaded)try{await this.loadAsZip(),await this.parseOpf(),await this.parseNcx(),this.loaded=!0}catch(t){throw t}}async loadAsZip(){if(void 0===this.file)throw new Error("file not found.");this.zip=await n.loadAsync(this.file),this.fileList=Object.keys(this.zip.files)}async getOpfFilePath(){const t=()=>{const t=this.fileList.find((t=>/[\s\S]+\.opf/g.test(t)));if(void 0===t)throw new Error("opf filepath not found");return t},e=this.zip.file("META-INF/container.xml");if(null===e)return t();const i=await e.async("text"),s=this.dp.parseFromString(i,"text/xml").getElementsByTagName("rootfile")[0];if(void 0===s)return t();const n=s.getAttribute("full-path");return null===n?t():n}async parseOpf(){this.opfFilePath=await this.getOpfFilePath();const t=D(this.opfFilePath),e=this.zip.file(this.opfFilePath);if(null===e)throw new Error("opf file not found");const i=await e.async("string");this.opfDoc=this.dp.parseFromString(i,"text/xml");const s=this.opfDoc.getElementsByTagName("manifest")[0];if(void 0===s)throw new Error("the opf file has no manifest");const n=[...s.children].map((t=>t.getAttribute("href"))).filter((t=>null!==t));this.textFileList=n.filter((t=>/[\s\S]+\.(xhtml|html)/g.test(t))).map((e=>H(t,e))),this.textPath=N(this.textFileList),this.styleFileList=this.fileList.filter((t=>/[\s\S]+\.css/g.test(t))),this.stylePath=N(this.styleFileList),this.imageFileList=this.fileList.filter((t=>/[\s\S]+\.(png|jpe?g|gif|svg)/g.test(t))),this.imagePath=N(this.imageFileList);for(let a of this.imageFileList)this.imageBlobs.push({path:a,blob:await this.getImage(a)})}async getTextDoc(t){if(void 0!==this.textDocs[t])return this.textDocs[t];const e=this.zip.file(t);if(null===e)return new Document;const i=await e.async("string"),s=this.dp.parseFromString(i,"text/html");return this.textDocs[t]=s,s}async updateImageSrc(t,e){const i=(await this.getTextDoc(t)).getElementsByTagName("img");for(let s of i){let i=s.getAttribute("src");null!==i&&(i=H(t,i),void 0!==e[i]&&s.setAttribute("src",e[i]))}}async getTextBody(t){return(await this.getTextDoc(t)).body.innerHTML}getNcxFilePath(){const t=()=>{const t=this.fileList.find((t=>/[\s\S]+\.ncx/g.test(t)));if(void 0===t)throw new Error("ncx filepath not found");return t},e=this.opfDoc.getElementById("ncx");if(null===e)return t();const i=e.getAttribute("href");return null===i?t():H(this.opfFilePath,i)}async parseNcx(){this.ncxFilePath=this.getNcxFilePath();const t=this.zip.file(this.ncxFilePath);if(null===t)throw new Error(".ncx file not found");const e=await t.async("text");this.ncxDoc=this.dp.parseFromString(e,"text/xml")}async getNavFlat(){const t=[...this.ncxDoc.getElementsByTagName("navPoint")],e={};return t.forEach((t=>{const i=t.getElementsByTagName("text")[0].innerHTML;let s=t.getElementsByTagName("content")[0].getAttribute("src");null!==s&&(s=s.split("#")[0],s=H(this.ncxFilePath,s),e[s]=i)})),e}getMetadata(){const t=this.opfDoc.getElementsByTagName("metadata")[0];if(!t)return{};const e=[...t.children],i={};return e.forEach((t=>{let e=t.tagName;if(!1===/dc:[\s\S]+/g.test(e))return;e=e.slice(3);const s=t.innerHTML;i[e]=s})),i}async getCssListOfTextFile(t){return[...(await this.getTextDoc(t)).getElementsByTagName("link")].map((t=>{const e=t.getAttribute("href");return null===e?"":e})).filter((t=>""!==t)).map((e=>H(t,e)))}async getInternalStyle(t){const e=[...(await this.getTextDoc(t)).getElementsByTagName("style")];if(0===e.length)return"";return e.map((t=>t.innerHTML)).reduce(((t,e)=>`${t}\n${e}`))}async getCssText(t){const e=this.zip.file(t);return null===e?"":await e.async("string")}async getImage(t){const e=this.zip.file(t);if(null===e)throw new Error("file not found");return e.async("blob")}async addImage(t){if(!this.loaded)return"";const e=t.name,i=t.type,s=this.imagePath+e;this.zip.file(s,t);const n=this.opfDoc,a=n.getElementsByTagName("manifest")[0],o=n.createElement("item");return o.setAttribute("href",C(this.opfFilePath,s)),o.setAttribute("media-type",i),a.appendChild(o),s}async saveTextFile(t,e,i){const s=await this.getTextDoc(t);s.body.innerHTML=e;const n=s.getElementsByTagName("img");for(let o of n){let e=o.getAttribute("src");null!==e&&(void 0!==i[e]&&(e=C(t,i[e]),o.setAttribute("src",e)))}const a=s.documentElement.outerHTML;this.zip.file(t,a)}saveStyleFile(t,e){this.zip.file(t,e)}async saveOpfFile(){const t=this.opfDoc.documentElement.outerHTML;this.zip.file(this.opfFilePath,t)}async saveMetadata(t){const e=Object.keys(t),i=this.opfDoc;let s=i.getElementsByTagName("metadata")[0];if(void 0===s){const t=i.createElement("metadata");i.appendChild(t),s=t}for(let n of e){const e=`dc:${n}`,a=i.getElementsByTagName(e)[0];if(void 0===a){const a=i.createElement(e);a.innerHTML=t[n],s.appendChild(a)}else a.innerHTML=t[n]}}async getBlob(){return this.saveOpfFile(),await this.zip.generateAsync({type:"blob"})}}const A=[115,116,121,125,131,200,201,202,203,204,205,206,207,300];class _{constructor(t){this.view=new DataView(t),this.buffer=new Uint8Array(t),this.offset=0,this.pdbHeader=this.loadPdbHeader(),this.recordList=this.loadRecordList(),this.palmHeader=this.loadPalmHeader(),this.mobiHeader=this.loadMobiHeader(),this.exthList=this.loadExthHeader(),this.content=this.loadText(),this.loadIndex(),this.doc=(new DOMParser).parseFromString(this.content,"text/html"),this.imageBlobs=this.loadImages()}loadPdbHeader(){return{name:this.getStr(32),fileAttributes:this.getUint16(),version:this.getUint16(),creationTime:this.getUint32(),modificationTime:this.getUint32(),backupTime:this.getUint32(),modificationNumber:this.getUint32(),appinfo:this.getUint32(),sortinfo:this.getUint32(),type:this.getStr(4),creator:this.getStr(4),uid:this.getUint32(),nextRecordList:this.getUint32(),numRecords:this.getUint16()}}loadRecordList(){let t=new Array;for(let e=0;e<this.pdbHeader.numRecords;e++)t.push({offset:this.getUint32(),attribute:this.getUint32()});return t}loadPalmHeader(){const t=this.recordList[0];return this.offset=t.offset,{begin:this.offset,compression:this.getUint16(),unused:this.getUint16(),textLength:this.getUint32(),recordCount:this.getUint16(),recordSize:this.getUint16(),currentPosition:this.getUint16(),encryptionType:this.getUint16(),end:this.offset}}loadMobiHeader(){const t=this.offset;let e={begin:this.offset,identifier:this.getStr(4),headerLength:this.getUint32(),mobiType:this.getUint32(),textEncoding:this.getUint32(),uid:this.getUint32(),fileVersion:this.getUint32()};return this.offset+=40,e.firstNonBookindex=this.getUint32(),e.fullNameOffset=this.getUint32(),e.fullNameLength=this.getUint32(),e.Locale=this.getUint32(),e.inputLanguage=this.getUint32(),e.outputLanguage=this.getUint32(),e.minVersion=this.getUint32(),e.firstImageRec=this.getUint32(),e.huffmanRecordOffset=this.getUint32(),e.huffmanRecordCount=this.getUint32(),e.huffmanTableOffset=this.getUint32(),e.huffmanTableLength=this.getUint32(),e.exthFlags=this.getUint32(),this.offset+=36,e.drmOffset=this.getUint32(),e.drmCount=this.getUint32(),e.drmSize=this.getUint32(),e.drmFlags=this.getUint32(),this.offset+=8,e.firstContentRec=this.getUint16(),e.lastContentRec=this.getUint16(),this.offset+=44,e.extraflags=this.getUint32(),e.indexRecOffset=this.getUint32(),this.offset=t+e.headerLength,e}loadExthHeader(){if("EXTH"!==this.getStr(4))return[];this.getUint32();let t=this.getUint32();const e=[];for(;t>0;){const i=this.getUint32(),s=this.getUint32()-8;let n="";n=A.includes(i)&&4===s?this.getUint32():this.getStr(s),e.push({type:i,data:n}),t--}return e}loadText(){const t=this.palmHeader.recordCount,e=[];let i=0;const s=this.mobiHeader.extraflags;for(let o=1;o<=t;o++){let t=this.buffer.slice(this.recordList[o].offset,this.recordList[o+1].offset);const n=V(t,s);t=t.slice(0,t.length-n),2===this.palmHeader.compression&&(t=X(t)),i+=t.byteLength,e.push(t)}const n=new Uint8Array(i);let a=0;return e.forEach((t=>{n.set(t,a),a+=t.byteLength})),O(n)}loadIndex(){const t=this.mobiHeader.indexRecOffset;if(void 0===t||4294967295===t)return;const e=this.offset=this.recordList[t].offset;let i=this.getStr(4);if("INDX"!==i)return;const s=this.getUint32();this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32(),this.getUint32();this.offset=e+s;const n={identifier:this.getStr(4),headerLength:this.getUint32(),ctrlByteCount:this.getUint32(),tagTable:[]};for(let l=0;l<(n.headerLength-12)/4;l++)n.tagTable.push({tag:this.getUint8(),valueNum:this.getUint8(),mask:this.getUint8(),ctrlByteEnd:this.getUint8()});const a=this.mobiHeader.firstImageRec,o=[];for(let l=t;l<a;l++)o.push(this.buffer.slice(this.recordList[l].offset,this.recordList[l+1].offset));this.indexRecords=o}loadImages(){const t=[],e=this.mobiHeader.firstImageRec,i=this.mobiHeader.lastContentRec;for(let s=e;s<i;s++){const i=this.recordList[s].offset,n=this.recordList[s+1].offset,a=new Blob([this.buffer.slice(i,n)]);t.push({path:String(s-e+1).padStart(5,"0"),blob:a})}return t}updateImageSrc(t){[...this.doc.getElementsByTagName("img")].forEach((e=>{const i=e.getAttribute("recindex");if(null===i)return;const s=t[i];null!==s&&e.setAttribute("src",s)}))}getText(){return this.doc.body.innerHTML}setText(t){this.doc.body.innerHTML=t}saveFile(){const t=this.doc.documentElement.outerHTML,e=(new TextEncoder).encode(t),i=e.length,s=this.recordList[1].offset-this.recordList[0].offset,{recordList:n,textRecNum:a,indexRec:o,firstImageRec:l,lastContentRec:r,flisRec:c,fcisRec:h,eofRec:d}=function(t,e,i,s){const n=[],a=Math.ceil(e/4096);let o=8*(a+s.length+i.length+4)+2+78;function l(t){n.push({offset:o,attribute:2*n.length}),o+=t}l(t);for(;e>0;)l(Math.min(4096,e)),e-=4096;return i.forEach((t=>{l(t.length)})),s.forEach((t=>{l(t.blob.size)})),l(36),l(44),l(4),{recordList:n,textRecNum:a,indexRec:a+1,firstImageRec:a+i.length+1,lastContentRec:n.length-4,flisRec:n.length-3,fcisRec:n.length-2,eofRec:n.length-1}}(s,i,this.indexRecords,this.imageBlobs),u=function(t){const e=8*t.length+2,i=new DataView(new ArrayBuffer(e));let s=0;return t.forEach((t=>{i.setUint32(s,t.offset),i.setUint32(s+4,t.attribute),s+=8})),i.buffer}(n);let f=this.buffer.slice(0,78).buffer;const g=new DataView(f);g.setUint16(76,n.length),f=g.buffer;let p=this.buffer.slice(this.palmHeader.begin,this.recordList[1].offset).buffer;const m=new DataView(p);m.setUint16(0,1),m.setUint32(4,i),m.setUint16(8,a),m.setUint32(108,l),m.setUint16(194,r),m.setUint32(200,h),m.setUint32(208,c),m.setUint32(240,1),m.setUint32(244,o),p=m.buffer;const y=this.mobiHeader.firstNonBookindex,b=this.recordList[y].offset,x=this.buffer.slice(b);return new Blob([f,u,p,e,x])}getUint8(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}getUint16(){const t=this.view.getUint16(this.offset);return this.offset+=2,t}getUint32(){const t=this.view.getUint32(this.offset);return this.offset+=4,t}getStr(t){let e=O(this.buffer.slice(this.offset,this.offset+t));return this.offset+=t,e}}function O(t){return new TextDecoder("utf-8").decode(t)}function V(t,e){for(var i=t.length-1,s=0,n=15;n>0;n--)if(e&1<<n){var a=j(t,i),o=a[0],l=a[1];i=a[2],i-=o-l,s+=o}1&e&&(s+=1+(3&t[i]));return s}function j(t,e){for(var i=0,s=0,n=0,a=0,o=0;;o++){var l=t[e];if(s|=(127&l)<<a,a+=7,i+=1,e-=1,(n+=1)>=4||(128&l)>0)break}return[s,i,e]}function X(t){const e=new Uint8Array(8*t.length);let i=0,s=0;for(;i<t.length;){let n=t[i++];if(0===n||n>=9&&n<=127)e[s++]=n;else if(n>=1&&n<=8){for(let a=0;a<n&&i+a<t.length;a++)e[s++]=t[i+a];i+=n}else if(n>=128&&n<=191){if(i>t.length)break;n=n<<8|t[i++];const a=3+(7&n),o=n>>3&2047;if(o<=0||o>s)break;for(let t=0;t<a;t++){const t=s-o;e[s++]=e[t]}}else n>=192&&(e[s++]=32,e[s++]=128^n)}return e.slice(0,s)}function $(t,e){!function(){const t=document.getElementById("book-css");null!==t&&document.head.removeChild(t)}(),t=function(t,e){var i;const s=(new Document).implementation.createHTMLDocument(""),n=document.createElement("style");return n.innerText=t,s.body.appendChild(n),[...null==(i=n.sheet)?void 0:i.cssRules].map((t=>`${e}`+t.cssText)).join("\n")}(t,e);const i=document.createElement("style");i.setAttribute("id","book-css"),i.innerText=t,document.head.appendChild(i)}class q{constructor(){this.urlMap={},this.pathMap={}}set(t,e){this.urlMap[t]=e,this.pathMap[e]=t}setUrls(t){this.revoke(),t.forEach((t=>{this.set(t.path,URL.createObjectURL(t.blob))}))}revoke(){Object.values(this.urlMap).forEach(window.URL.revokeObjectURL),this.urlMap={},this.pathMap={}}}var K=t({props:{text:String},emits:["update:text"],setup(t,{emit:e}){const n=t,a=o();let c;return l((()=>{c=r(a.value,{value:n.text,mode:"css",lineNumbers:!0,viewportMargin:1/0}),c.on("change",(t=>{e("update:text",t.getValue())}))})),(t,e)=>(i(),s("div",{id:"cm",ref:a},null,512))}});K.__scopeId="data-v-19fb7a74";const Z=u("data-v-5bee36e1");var J=t({props:{data:{type:Object,required:!0}},setup(t){const n=t,a=o({key:"",value:""});function l(){const t=n.data,e=a.value.key,i=a.value.value;""!==e&&""!==i&&(t[e]=i)}return(n,o)=>{const r=e("el-input"),u=e("el-form-item"),f=e("el-form"),g=e("el-button");return i(),s("main",null,[c(f,{model:t.data,"label-position":"right","label-width":"100px"},{default:Z((()=>[(i(!0),s(h,null,d(Object.keys(t.data),(e=>(i(),s(u,{label:e,key:e},{default:Z((()=>[c(r,{modelValue:t.data[e],"onUpdate:modelValue":i=>t.data[e]=i,type:t.data[e].length<50?"text":"textarea",autosize:""},null,8,["modelValue","onUpdate:modelValue","type"])])),_:2},1032,["label"])))),128))])),_:1},8,["model"]),c(f,{id:"add-form",model:a.value},{default:Z((()=>[c(u,{id:"key-input"},{default:Z((()=>[c(r,{modelValue:a.value.key,"onUpdate:modelValue":o[1]||(o[1]=t=>a.value.key=t)},null,8,["modelValue"])])),_:1}),c(u,{id:"value-input"},{default:Z((()=>[c(r,{modelValue:a.value.value,"onUpdate:modelValue":o[2]||(o[2]=t=>a.value.value=t)},null,8,["modelValue"])])),_:1}),c(u,null,{default:Z((()=>[c(g,{type:"primary",onClick:l,icon:"el-icon-plus",circle:"",plain:""})])),_:1})])),_:1},8,["model"])])}}});J.__scopeId="data-v-5bee36e1";var W=t({setup:t=>(t,n)=>{const a=e("el-alert");return i(),s(h,null,[c(a,{title:"Mobi is not fully supported",type:"warning",description:"Potential problems: Index/TOC in chaos; Text encoded wrong; Image not inserted...","show-icon":"",closable:!1}),c(a,{title:"未能完全支持 Mobi 格式",type:"warning",description:"潜在问题: 目录错乱；文字编码错误；图片插入失败……","show-icon":"",closable:!1}),c(a,{title:"Mobi is edited in a single html",type:"info",description:"File will be saved as mobi(6th version), without the KF8 parts","show-icon":"",closable:!1}),c(a,{title:"您将在单一 HTML 文件中编辑 Mobi 文本",type:"info",description:"保存格式为 6 代 Mobi 文件, 不包括 KF8 部分","show-icon":"",closable:!1})],64)}});W.__scopeId="data-v-4c9828c2";const G=u("data-v-011d6fa6");var Q=t({props:{text:{type:String,required:!0}},emits:["update:text","addImage"],setup(t,{emit:n}){const a=t;let r;f((t=>({"0ce8c742":u.value})));const d=o();l((()=>{var t;t=a.text,r&&r.destroy(),r=new g(d.value),r.config.menus=["head","bold","italic","underline","strikeThrough","quote","list","splitLine","indent","justify","image","undo","redo"],r.config.lang="en",r.i18next=p,r.config.showFullScreen=!1,r.config.showMenuTooltips=!1,r.config.placeholder="",r.config.zIndex=50,r.config.showLinkImg=!1,r.config.uploadImgMaxLength=1,r.config.customUploadImg=async(t,e)=>{const i=t[0],s=URL.createObjectURL(i);e(s),n("addImage",i,s)},r.create(),r.txt.html(t),r.config.zIndex=1,r.config.onchange=()=>{n("update:text",r.txt.html())},setTimeout((()=>{r.history.observe()}),100)}));const u=o(1);function m(){u.value+=.1}function y(){u.value>=.2&&(u.value-=.1)}return(t,n)=>{const a=e("el-button"),o=e("el-button-group");return i(),s(h,null,[c("div",{id:"we",ref:d},null,512),c(o,{id:"zoom"},{default:G((()=>[c(a,{round:"",icon:"el-icon-zoom-out",size:"medium",onClick:y}),c(a,{round:"",icon:"el-icon-zoom-in",size:"medium",onClick:m})])),_:1})],64)}}});Q.__scopeId="data-v-011d6fa6";const Y=u("data-v-2be96db2");m("data-v-2be96db2");const tt={id:"container"},et={class:"aside-box",id:"input"},it={class:"aside-box",id:"buttons"},st=k("New"),nt=k("Save"),at={key:0,class:"aside-box"},ot=c("i",{class:"el-icon-document"},null,-1),lt=c("span",null," Text / XHTML",-1),rt=c("i",{class:"el-icon-brush"},null,-1),ct=c("span",null," Stylesheet / CSS",-1),ht=c("i",{class:"el-icon-more-outline"},null,-1),dt=c("span",null," Others",-1),ut=k("Metadata"),ft={key:0},gt={key:1};y();var pt=t({setup(t){l((async()=>{const t=await(await fetch("./demo.epub")).blob();I(new File([t],"demo.epub"))}));const n=o("");async function a(t,e){if("epub"===P.type){const i=await p.addImage(t);S.set(i,e)}}const r=o();function u(){r.value.click()}function f(t){const e=t.target;if(null===e.files||0===e.files.length)return;const i=e.files[0];"application/epub+zip"===i.type?I(i):async function(t){g=new _(await t.arrayBuffer()),console.log(g),P.type="mobi",P.name=t.name,P.files=[],P.textFileList=[],P.styleFileList=[],P.editedFilePath="",P.editedFileType="text",S.setUrls(g.imageBlobs),g.updateImageSrc(S.urlMap),n.value=g.getText(),$("",".w-e-text ")}(i)}let g,p;const m=o({}),y=o(!0),S=new q,P=b({name:"",type:"epub",files:[],textFileList:[],styleFileList:[],editedFilePath:"",editedFileType:"text"});async function I(t){try{y.value=!0,p=new z(t),await p.load(),S.setUrls(p.imageBlobs),m.value=await p.getNavFlat(),P.name=t.name,P.type="epub",P.textFileList=p.textFileList,P.styleFileList=p.styleFileList,P.editedFilePath="",await B(P.textFileList[0])}catch(e){console.error(e),x.error("加载失败")}finally{setTimeout((()=>{y.value=!1}),200)}}async function B(t){""!==P.editedFilePath&&await D(),await p.updateImageSrc(t,S.urlMap);const e=await p.getTextBody(t);n.value=e,P.editedFilePath=t,P.editedFileType="text",await async function(t){const e=await p.getCssListOfTextFile(t);let i="";for(let s of e)i+=await p.getCssText(s)+"\n";i+=await p.getInternalStyle(t),$(i,".w-e-text ")}(t)}const R=o("");const H=o({});function C(){H.value=p.getMetadata(),P.editedFileType="metadata"}async function D(){const t=P.editedFilePath;if(""===t)return;const e=P.editedFileType;if("text"===e){const e=n.value;await p.saveTextFile(t,e,S.pathMap)}else"style"===e?p.saveStyleFile(t,R.value):"metadata"===e&&p.saveMetadata(H.value)}const N=o(!1);async function A(){if("mobi"===P.type){if(void 0===g)return;const t=n.value;g.setText(t),E.exports.saveAs(g.saveFile(),"test.mobi")}else{if(void 0===p)return;N.value=!0,await D();const t=await p.getBlob();E.exports.saveAs(t,P.name),N.value=!1}}const O=o(!1),V=o(!1),j=o({position:"fixed",transform:"translateX(-100%)",transition:"all 0.3s ease-out",boxShadow:"0 2px 10px 0 rgba(0, 0, 0, 0.1)"});function X(){!1===V.value?(j.value.transform="translateX(0)",V.value=!0):(j.value.transform="translateX(-100%)",V.value=!1)}return window.onresize=()=>{O.value=window.innerWidth<800},(t,o)=>{const l=e("el-button"),g=e("el-input"),b=e("el-menu-item"),x=e("el-menu-item-group"),E=e("el-menu"),S=e("el-scrollbar"),I=v("loading");return i(),s(h,null,[w(c("section",tt,[c("aside",{style:O.value?j.value:void 0},[c("div",et,[c(g,{placeholder:"请打开文件",modelValue:U(P).name,"onUpdate:modelValue":o[1]||(o[1]=t=>U(P).name=t)},{append:Y((()=>[c(l,{icon:"el-icon-folder-opened",onClick:u})])),_:1},8,["modelValue"])]),c("div",it,[c(l,{disabled:"",round:"",size:"medium",icon:"el-icon-circle-plus-outline"},{default:Y((()=>[st])),_:1}),c(l,{round:"",plain:"",size:"medium",type:"primary",onClick:A,loading:N.value,icon:"el-icon-folder-checked"},{default:Y((()=>[nt])),_:1},8,["loading"])]),"mobi"===U(P).type?(i(),s("div",at,[c(W)])):L("",!0),"epub"===U(P).type?(i(),s(S,{key:1,class:"aside-box",id:"menu",always:!0},{default:Y((()=>[c(E,{"default-active":"1-0",key:U(P).name},{default:Y((()=>[c(x,null,{title:Y((()=>[ot,lt])),default:Y((()=>[(i(!0),s(h,null,d(U(P).textFileList,((t,e)=>(i(),s(b,{key:e,index:`1-${e}`,onClick:e=>B(t)},{default:Y((()=>[k(M(m.value[t]||t.split("/").pop()),1)])),_:2},1032,["index","onClick"])))),128))])),_:1}),c(x,null,{title:Y((()=>[rt,ct])),default:Y((()=>[(i(!0),s(h,null,d(U(P).styleFileList,((t,e)=>(i(),s(b,{key:e,index:`2-${e}`,onClick:e=>async function(t){await D(),R.value=await p.getCssText(t),P.editedFilePath=t,P.editedFileType="style"}(t)},{default:Y((()=>[k(M(t.split("/").pop()),1)])),_:2},1032,["index","onClick"])))),128))])),_:1}),c(x,null,{title:Y((()=>[ht,dt])),default:Y((()=>[c(b,{onClick:C,index:"3"},{default:Y((()=>[ut])),_:1})])),_:1})])),_:1})])),_:1})):L("",!0)],4),w(c("main",null,[(i(),s(T,null,[c(Q,{text:n.value,"onUpdate:text":o[2]||(o[2]=t=>n.value=t),onAddImage:a,key:U(P).editedFilePath},null,8,["text"])],1024))],512),[[F,"text"===U(P).editedFileType]]),"style"===U(P).editedFileType?(i(),s("main",ft,[c(K,{text:R.value,"onUpdate:text":o[3]||(o[3]=t=>R.value=t),key:U(P).editedFilePath},null,8,["text"])])):L("",!0),"metadata"===U(P).editedFileType?(i(),s("main",gt,[c(J,{data:H.value},null,8,["data"])])):L("",!0)],512),[[I,y.value]]),w(c("input",{type:"file",ref:r,accept:".epub, .mobi",onChange:f},null,544),[[F,!1]]),w(c(l,{class:"aside-button",onClick:X,circle:"",icon:"el-icon-arrow-"+(V.value?"left":"right"),type:"primary"},null,8,["icon"]),[[F,O.value]])],64)}}});pt.__scopeId="data-v-2be96db2";var mt=t({setup:t=>(t,e)=>null});mt.__scopeId="data-v-6695d3a9";const yt=[{path:"/editor",component:pt},{path:"/test",component:mt},{path:"/",redirect:"/editor"}],bt=S({history:P("/BookScript/"),routes:yt});const xt=I(R);xt.use(bt).use(B).mount("#app"),xt.config.performance=!0;
